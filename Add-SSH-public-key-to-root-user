---
- name: Add SSH public key to root user
  hosts: all
  become: false
  gather_facts: false

  vars:
    ssh_public_key: "{{ lookup('file', '~/.ssh/ansible.pub') }}"

  tasks:
    - name: Ensure .ssh directory exists
      file:
        path: /root/.ssh
        state: directory
        mode: '0700'
        owner: root
        group: root

    - name: Add SSH public key to authorized_keys
      authorized_key:
        user: root
        key: "{{ ssh_public_key }}"
        path: /root/.ssh/authorized_keys
        manage_dir: false
        state: present

    - name: Ensure correct permissions on authorized_keys
      file:
        path: /root/.ssh/authorized_keys
        mode: '0600'
        owner: root
        group: root
